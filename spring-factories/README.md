# Spring Factories Example

é€™å€‹å°ˆæ¡ˆå±•ç¤ºäº† Spring Factories æ©Ÿåˆ¶ï¼Œé€é `META-INF/spring.factories` æ–‡ä»¶ä¾†è¨»å†Šå’Œç™¼ç¾æœå‹™å¯¦ä½œã€‚

## ğŸ—ï¸ å°ˆæ¡ˆçµæ§‹åœ–

```
ğŸ“ spring-factories (æ ¹ç›®éŒ„)
â”œâ”€â”€ ğŸ“„ pom.xml                    # çˆ¶ POMï¼ˆèšåˆå™¨ï¼‰
â”œâ”€â”€ ğŸ“„ README.md                  # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ logger-api/                # API æ¨¡çµ„
â”‚   â”œâ”€â”€ ğŸ“„ pom.xml
â”‚   â””â”€â”€ ğŸ“ src/main/java/com/example/api/
â”‚       â””â”€â”€ ğŸ“„ Logger.java        # æœå‹™ä»‹é¢
â”‚
â”œâ”€â”€ ğŸ“ custom-logger/             # å¯¦ä½œæ¨¡çµ„ 1
â”‚   â”œâ”€â”€ ğŸ“„ pom.xml
â”‚   â”œâ”€â”€ ğŸ“ src/main/java/com/example/logger/
â”‚   â”‚   â””â”€â”€ ğŸ“„ CustomLogger.java  # å¯¦ä½œé¡åˆ¥ (priority: 100)
â”‚   â””â”€â”€ ğŸ“ src/main/resources/META-INF/
â”‚       â””â”€â”€ ğŸ“„ spring.factories   # Spring Factories è¨»å†Šæ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ custom-logger-v2/          # å¯¦ä½œæ¨¡çµ„ 2
â”‚   â”œâ”€â”€ ğŸ“„ pom.xml
â”‚   â”œâ”€â”€ ğŸ“ src/main/java/com/example/loggerv2/
â”‚   â”‚   â””â”€â”€ ğŸ“„ CustomLoggerV2.java # å¯¦ä½œé¡åˆ¥ (priority: 200)
â”‚   â””â”€â”€ ğŸ“ src/main/resources/META-INF/
â”‚       â””â”€â”€ ğŸ“„ spring.factories   # Spring Factories è¨»å†Šæ–‡ä»¶
â”‚
â””â”€â”€ ğŸ“ main-app/                  # ä¸»æ‡‰ç”¨ç¨‹å¼
    â”œâ”€â”€ ğŸ“„ pom.xml
    â”œâ”€â”€ ğŸ“„ run.sh                 # åŸ·è¡Œè…³æœ¬
    â””â”€â”€ ğŸ“ src/main/java/com/example/main/
        â””â”€â”€ ğŸ“„ Main.java          # ä¸»ç¨‹å¼
```

## ğŸ”„ Spring Factories vs Java SPI

| ç‰¹æ€§ | Spring Factories | Java SPI |
|------|------------------|----------|
| é…ç½®æ–‡ä»¶ | `META-INF/spring.factories` | `META-INF/services/ä»‹é¢å…¨å` |
| è¼‰å…¥å™¨ | `SpringFactoriesLoader` | `ServiceLoader` |
| æ ¼å¼ | Key=Value æ ¼å¼ | æ¯è¡Œä¸€å€‹å¯¦ä½œé¡åˆ¥ |
| ä¾è³´ | éœ€è¦ Spring Core | JDK å…§å»º |
| éˆæ´»æ€§ | æ”¯æ´å¤šç¨®é¡å‹æ˜ å°„ | åƒ…æ”¯æ´ä»‹é¢å°æ‡‰ |

## ğŸ“ Spring Factories æ–‡ä»¶æ ¼å¼

### custom-logger/src/main/resources/META-INF/spring.factories
```properties
# Spring Factories é…ç½®æ–‡ä»¶
# æ ¼å¼: ä»‹é¢é¡åˆ¥åç¨±=å¯¦ä½œé¡åˆ¥åç¨±1,å¯¦ä½œé¡åˆ¥åç¨±2,...

com.example.api.Logger=com.example.logger.CustomLogger
```

### custom-logger-v2/src/main/resources/META-INF/spring.factories
```properties
# Spring Factories é…ç½®æ–‡ä»¶
# æ ¼å¼: ä»‹é¢é¡åˆ¥åç¨±=å¯¦ä½œé¡åˆ¥åç¨±1,å¯¦ä½œé¡åˆ¥åç¨±2,...

com.example.api.Logger=com.example.loggerv2.CustomLoggerV2
```

## ğŸ¯ Spring Factories é‹ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SpringFactoriesLoader åŸ·è¡Œæµç¨‹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SpringFactoriesLoader.loadFactories(Logger.class, classLoader)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æƒæ classpath ä¸­æ‰€æœ‰ JAR çš„ META-INF/spring.factories æ–‡ä»¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚custom-logger.jar â”‚ â”‚custom-logger-v2  â”‚ â”‚å…¶ä»– JAR æ–‡ä»¶      â”‚
â”‚                  â”‚ â”‚    .jar          â”‚ â”‚                  â”‚
â”‚æ‰¾åˆ° spring.      â”‚ â”‚æ‰¾åˆ° spring.      â”‚ â”‚æ²’æœ‰ spring.      â”‚
â”‚factories æ–‡ä»¶    â”‚ â”‚factories æ–‡ä»¶    â”‚ â”‚factories æ–‡ä»¶    â”‚
â”‚Key: Logger       â”‚ â”‚Key: Logger       â”‚ â”‚                  â”‚
â”‚Value: CustomLog  â”‚ â”‚Value: CustomLog  â”‚ â”‚                  â”‚
â”‚      ger         â”‚ â”‚      gerV2       â”‚ â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                â”‚                â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. åˆä½µæ‰€æœ‰ spring.factories æ–‡ä»¶ä¸­çš„ com.example.api.Logger é …ç›®â”‚
â”‚    - com.example.logger.CustomLogger                           â”‚
â”‚    - com.example.loggerv2.CustomLoggerV2                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¯¦ä¾‹åŒ–æ‰€æœ‰å¯¦ä½œé¡åˆ¥:                                           â”‚
â”‚    - Class.forName() + newInstance()                           â”‚
â”‚    - å›å‚³ List<Logger>                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Main.java é¸æ“‡æœ€é«˜å„ªå…ˆç´š:                                     â”‚
â”‚    CustomLoggerV2 (priority: 200) > CustomLogger (priority: 100)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ä¸»è¦ç¨‹å¼ç¢¼

### Main.java (ä½¿ç”¨ SpringFactoriesLoader)
```java
// ä½¿ç”¨ SpringFactoriesLoader è¼‰å…¥æ‰€æœ‰ Logger å¯¦ä½œ
List<Logger> loggers = SpringFactoriesLoader.loadFactories(
    Logger.class, 
    Main.class.getClassLoader()
);

// é¸æ“‡æœ€é«˜å„ªå…ˆç´šçš„ Logger
Logger bestLogger = loggers.stream()
    .max(Comparator.comparing(Logger::getPriority))
    .orElse(null);
```

## ğŸš€ å»ºç½®å’ŒåŸ·è¡Œ

### ä½¿ç”¨ Maven Exec Pluginï¼ˆæ¨è–¦ï¼‰
```bash
# å»ºç½®æ‰€æœ‰æ¨¡çµ„
cd spring-factories
mvn clean package

# åŸ·è¡Œä¸»æ‡‰ç”¨ç¨‹å¼
mvn exec:java -pl main-app
```

### ä½¿ç”¨åŸ·è¡Œè…³æœ¬
```bash
# å»ºç½®æ‰€æœ‰æ¨¡çµ„
cd spring-factories
mvn clean package

# ä½¿ç”¨æä¾›çš„è…³æœ¬åŸ·è¡Œ
cd main-app
./run.sh
```

## ğŸ“Š é æœŸè¼¸å‡º

```
Available loggers (via Spring Factories):
- CustomLogger (priority: 100)
- CustomLoggerV2 (priority: 200)

Selected: CustomLoggerV2
[CustomLoggerV2] Hello from Spring Factories!
```

## âœ¨ Spring Factories çš„å„ªå‹¢

1. **çµ±ä¸€é…ç½®**: æ‰€æœ‰å·¥å» é…ç½®éƒ½åœ¨åŒä¸€å€‹æ–‡ä»¶ä¸­
2. **é¡å‹å®‰å…¨**: æ”¯æ´æ³›å‹å’Œé¡å‹æª¢æŸ¥
3. **è¼‰å…¥æ§åˆ¶**: å¯ä»¥é¸æ“‡æ€§è¼‰å…¥ç‰¹å®šé¡å‹
4. **Spring ç”Ÿæ…‹**: èˆ‡ Spring Framework æ·±åº¦æ•´åˆ
5. **æ‰¹é‡è¼‰å…¥**: ä¸€æ¬¡è¼‰å…¥å¤šå€‹å¯¦ä½œ

## ğŸ”§ æŠ€è¡“ç´°ç¯€

- **Java 8 ç›¸å®¹**
- **Maven å¤šæ¨¡çµ„å°ˆæ¡ˆ**
- **Spring Core 5.1.8.RELEASE (Java 8 ç›¸å®¹ç‰ˆæœ¬)**
- **ä½¿ç”¨ SpringFactoriesLoader**
- **é€é META-INF/spring.factories æ–‡ä»¶é€²è¡Œæœå‹™è¨»å†Š**

## ğŸ› ï¸ JAR æ–‡ä»¶å…§å®¹çµæ§‹

```
custom-logger-1.0.jar
â”œâ”€â”€ com/example/logger/
â”‚   â””â”€â”€ CustomLogger.class
â””â”€â”€ META-INF/
    â””â”€â”€ spring.factories  â† å…§å®¹: "com.example.api.Logger=com.example.logger.CustomLogger"

custom-logger-v2-1.0.jar
â”œâ”€â”€ com/example/loggerv2/
â”‚   â””â”€â”€ CustomLoggerV2.class
â””â”€â”€ META-INF/
    â””â”€â”€ spring.factories  â† å…§å®¹: "com.example.api.Logger=com.example.loggerv2.CustomLoggerV2"

main-app-1.0.jar
â””â”€â”€ com/example/main/
    â””â”€â”€ Main.class  â† ä½¿ç”¨ SpringFactoriesLoader.loadFactories()
```

## ğŸ“ Spring Factories vs Java SPI æ¯”è¼ƒ

### ç›¸åŒé»:
- éƒ½æ”¯æ´æœå‹™ç™¼ç¾æ©Ÿåˆ¶
- éƒ½ä½¿ç”¨ META-INF ç›®éŒ„ä¸‹çš„é…ç½®æ–‡ä»¶
- éƒ½æ”¯æ´é‹è¡Œæ™‚å‹•æ…‹è¼‰å…¥

### ä¸åŒé»:

#### Spring Factories:
- âœ… æ”¯æ´ä¸€å°å¤šæ˜ å°„ï¼ˆä¸€å€‹ key å°æ‡‰å¤šå€‹ valueï¼‰
- âœ… æ”¯æ´ä»»æ„é¡å‹è¼‰å…¥ï¼ˆä¸åƒ…åƒ…æ˜¯ä»‹é¢ï¼‰
- âœ… é…ç½®æ›´éˆæ´»ï¼ˆKey=Value æ ¼å¼ï¼‰
- âŒ éœ€è¦ Spring Core ä¾è³´

#### Java SPI:
- âœ… JDK å…§å»ºï¼Œç„¡å¤–éƒ¨ä¾è³´
- âœ… æ¨™æº–åŒ–çš„æœå‹™ç™¼ç¾æ©Ÿåˆ¶
- âŒ åƒ…æ”¯æ´ä»‹é¢å¯¦ä½œè¼‰å…¥
- âŒ é…ç½®ç›¸å°ç°¡å–®

## ğŸ“š å¦‚ä½•æ“´å±•

è¦æ·»åŠ æ–°çš„ logger å¯¦ä½œï¼š

1. **å‰µå»ºæ–°æ¨¡çµ„** (ä¾‹å¦‚ `custom-logger-v3`)
2. **å¯¦ä½œ Logger ä»‹é¢**
3. **å‰µå»º spring.factories æ–‡ä»¶**ï¼š
   ```properties
   com.example.api.Logger=com.example.loggerv3.CustomLoggerV3
   ```
4. **è¨­å®šé©ç•¶çš„å„ªå…ˆç´š**
5. **æ·»åŠ åˆ° main-app çš„ä¾è³´**

ä¸»ç¨‹å¼æœƒè‡ªå‹•ç™¼ç¾æ–°çš„å¯¦ä½œï¼Œç„¡éœ€ä¿®æ”¹ä»»ä½•ç¾æœ‰ä»£ç¢¼ï¼
